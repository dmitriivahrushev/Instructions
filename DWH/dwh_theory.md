# Что такое DWH  
Хранилище данных (англ. Data Warehouse) — класс систем для хранения обработанных данных из разных источников. 
![DWH](/image/dwh_layer.png)
DWH хранят большой объём исторических данных и рассчитаны на аналитическую нагрузку. Поэтому для работы с ними выбирают соответствующие оптимизированные базы данных. Например, Vertica, Greenplum, ClickHouse, Exasol, Teradata, Exadata, SAP HANA.  

---

# Методика OLTP (Online Transaction Processing)  
OLTP — это методика разработки и эксплуатации баз данных, направленная на эффективное выполнение коротких, простых и частых транзакционных операций (операции типа CRUD: create, read, update, delete). Такие системы обеспечивают высокую производительность и надежность при массовом количестве мелких операций, поддерживая быстрые бизнес-процессы.  
**Основные характеристики OLTP:** 
- Минимальное время отклика.  
- Высокий объем параллельных транзакций.   
- Оптимизация структуры данных для быстрых выборок конкретных строк. 
- Использование реляционных моделей данных.  
- Поддержка целостности данных и согласованности транзакций.
   
**Применение:**
- Банкинг (проведение платежей, снятие денег).  
- Онлайн-магазины (оформление заказов, проверка наличия товара).  
- ERP/CRM-системы (учет клиентов, ведение документации).  

---

# Методика OLAP (Online Analytical Processing) 
OLAP — это подход к разработке и управлению информационными системами, предназначенных для аналитического анализа больших объемов структурированных данных. Цель — предоставление инструментов для формирования отчетов, выявления скрытых зависимостей и поддержки принятия управленческих решений путем обработки сложных запросов.  
**Основные характеристики OLAP:**  
- Многомерная организация данных («data cubes»). 
- Агрегация данных для быстрого вычисления итоговых показателей. 
- Возможность интерактивного взаимодействия с большими наборами данных. 
- Ориентация на аналитику и принятие стратегических решений.

**Применение:** 
- Бизнес-анализ (анализ продаж, доходности проектов). 
- Маркетинг (анализ клиентских предпочтений, поведения пользователей). 
- Финансовое управление (бюджетирование, контроль затрат). 

Таким образом, **OLTP** фокусируется на поддержке быстрой обработки многочисленных малых транзакций, необходимых для повседневной деятельности организаций, тогда как **OLAP** обеспечивает мощные инструменты для глубокой аналитики и выработки стратегически важных решений на основе собранных данных. 

![OLTP_OLAP](/image/oltp_olap.png)

---

# Модели «звезда» и «снежинка» 
Данные из DWH используют для анализа.И «звезда», и «снежинка» — денормализованные модели. При проектировании OLAP специально разрабатывают схемы, которые нарушают правила третьей нормальной формы и последующих. Из-за этого данные занимают больше места на диске. Однако меньшее число таблиц позволяет получить доступ к данным проще и быстрее, и вся нужная для анализа информация может хранится в одной таблице. 

# Модель «звезда» 
Схема **«звезда»** характеризуется наличием центральной таблицы фактов (fact table), связанной напрямую с несколькими таблицами измерений (dimension tables). Каждая таблица измерений имеет прямое соединение только с центральной таблицей фактов, образуя визуальную структуру, похожую на звезду, откуда и произошло название.
![star](/image/star.png)
При таком проектировании OLAP-системы увеличивается место хранения, но снижается время выполнения аналитических запросов, потому что соединений между таблицами меньше. 
# Модель «снежинка» 
Модель **«снежинка»**  отличается от обычной схемы **«звезда»**  тем, что измерения могут быть нормализованы и разделены на несколько связанных таблиц, создающих дополнительную глубину структуры. То есть одна таблица измерений сама становится связанной с другой таблицей измерений, образуя иерархию данных.
![snowflake](/image/snowflake.png)
Как и в предыдущем примере, центральная часть — таблица фактов, с которой соединены таблицы измерений. Но одна из таблиц измерений, Категория, связана с ещё одним измерением — Продукт. В итоге получается иерархия Название категории → Название продукта. То есть у лучей звезды появились свои лучи, и в таком виде визуально схема напоминает снежинку. 
# «Звезда» vs «снежинка» 
![star_vs_snowflake](/image/star_vs_snowflake.png)

# Что такое SCD 
SCD — это **Slowly Changing Dimensions**. В переводе с английского — «медленно меняющиеся измерения». Этим термином описывают механизм отслеживания изменения данных. Но не любых — а тех, которые по своей природе меняются редко и хранятся в таблицах измерений. 
- SCD0 — данные никогда не изменяются. 
- SCD1 — данные перезаписываются без сохранения истории. 
- SCD2 — сохраняется полная история изменений. 
- SCD3 — история изменений сохраняется в отдельный столбец и имеет ограниченную глубину. 
- SCD6 — комбинация SCD1, SCD2 и SCD3: при изменении данных перезаписываются все записи, относящиеся к одной сущности, и в таблицу добавляются новые строки с учётом версии, даты начала и даты окончания действия значения. Предыдущее значение хранится в отдельном столбце.

Также могут существовать гибридные SCD, которые используют другие комбинации SCD1, SCD2 и SCD3.

---

# Подход Инмона 
Билла Инмона принято называть отцом хранилищ данных: он начал обсуждать принципы DWH и ввёл этот термин ещё в 1970-х годах. В июле 2007 года издание **Computerworld** назвало Инмона одним из десяти человек, оказавших наибольшее влияние на первые 40 лет IT-индустрии. 

С конца 1970-х по 1980-е годы Инмон много работал с реляционными БД. За проектирование хранилищ он взялся в первой половине 1990-х годов, когда основал свою первую компанию **Prism Solutions.** Среди её продуктов был Prism Warehouse Manager — один из первых отраслевых инструментов для создания и управления хранилищем данных. 

В 1992 году Инмон опубликовал книгу **Building the Data Warehouse**. В ней сочетаются теория и реальные примеры, и для многих специалистов по работе с данными эта книга — часть библиотеки. 

Сегодня Билл Инмон продолжает работать с данными. Он руководит компанией **Forest Rim Technology**, которая применяет и внедряет решения для хранения данных. 

Классическое хранилище по Инмону состоит из следующих слоёв: 
- **Staging-область (Staging Area).**  
Этого слоя может не быть, если вместо ETL-процесса используется ELT и данные из источника трансформируются сразу в форму, пригодную для структуры основного слоя хранилища. Но раскладывать таблицы в 3NF — задача непростая, поэтому чаще всего в хранилищах по Инмону staging-слой есть.

- **Ядро DWH.**  
Это основной слой хранилища. Здесь хранятся очищенные данные, приведённые к общему виду. Как правило, данные хранятся в нём в 3NF.

- **Витрины данных (Data Marts).**  
Слой с витринами, которые предоставляют пользователям лёгкий доступ к различным срезам данных.

![inmon](/image/Inmon.png)

**Плюсы и минусы подхода**  
Хранилище данных, построенное по Инмону, отлично справляется с масштабированием, добавлением и удалением новых источников и других сущностей, сохраняя при этом целостность данных. Поэтому подход хорошо применим для создания корпоративных хранилищ с большим количеством бизнес-областей.
Плюсы такого хранилища становятся хорошо заметны спустя годы работы. В перспективе же пары лет разницу можно и не заметить. Таким образом, для небольших компаний без особых требований к истории данных подход Инмона излишне сложен и дорог.
Однако при реализации подхода Инмона разработка ETL-процессов сложнее, чем в подходе Кимбалла. Поскольку основной слой хранилища, ядро, нормализован, создать ETL-процессы, которые сразу бы преобразовывали данные и складывали их в нормализованные таблицы, непросто. Поэтому в большинстве случаев хранилища по Инмону имеют промежуточную staging-область, а также слой витрин, чтобы аналитики не мучались с объединением нескольких таблиц в 3NF.
К тому же, 3NF, к которой близок основной слой, подразумевает большое количество таблиц, что напрямую влияет на количество ETL-процессов и количество запросов, которые используют JOIN. 

# Подход Кимбалла 
В то время как книга Инмона **Building the Data Warehouse** обеспечила надёжную теоретическую основу для концепций, связанных с хранилищем, именно **The Data Warehouse Toolkit** Ральфа Кимбалла, опубликованная в 1996 году, объединила множество отработанных практических примеров моделирования OLAP-систем, в том числе концепцию медленно меняющихся измерений (SCD). 

Кимбалл начинал свою карьеру в качестве ключевого разработчика станции **Xerox Star Workstation**, первого компьютера, использующего мышь и оконную операционную систему — дело было в 1970-х годах. Полноценное приложение Data Warehouse стало основным продуктом собственной компании Кимбалла Red Brick Systems, основанной в 1986 году.
Red Brick был известен своей реляционной моделью, подходящей для высокоскоростных приложений хранилища. Кимбалл покинул Red Brick в 1992 году, чтобы основать собственную консалтинговую компанию Ralph Kimball Associates, которая теперь — часть **Kimball Group**. Вскоре последовала его знаменитая серия книг **Data Warehouse Toolkit**. Дополнительные тома этой серии посвящены смежным темам: веб-хранилище, ETL в среде хранилища, а также специальные выпуски **The Microsoft Data Warehouse Toolkit**, охватывающие SQL Server и набор инструментов Microsoft Business Intelligence. 

В классическом хранилище по Кимбаллу можно выделить следующие слои: 
- **Staging-область (Staging Area).** — может отсутствовать, если ETL-процесс берёт данные из источника и трансформирует их сразу в форму, пригодную для структуры основного слоя хранилища. 
- **Ядро DWH** — слой, на котором данные разложены на факты и измерения. 
- **Слой витрин (Data Marts)** — слой с витринами, которые предоставляют пользователям лёгкий доступ к различным срезам данных. Может отсутствовать, так как обращение к основному слою хранилища в подходе Кимбалла упрощено.

 ![kimbal](/image/kimbal.png)

**Применение подхода**  
Если вам нужно быстро и недорого создать хранилище для заказчика, который хочет получать ограниченный и строго определённый набор данных, хранилище по Кимбаллу — лучшее решение. Из-за меньшего количества таблиц и более простой логики ETL- и ELT-процессов (они не должны быть универсальны и обычно пишутся для загрузки каждой отдельной таблицы) разработка DWH с нуля и предоставление результата заказчику занимает гораздо меньше времени, чем при разработке хранилища по Инмону.
Но, конечно же, у этого подхода есть и недостатки: из-за отсутствия универсальности в сущностях и процессах хранилище очень сложно расширять, поэтому работа с ним в крупных компаниях в долгой перспективе становится затруднительной. 

# Инмон vs Кимбалл 
Сравним преимущества и недостатки каждой из методологий. 

**Преимущества хранилища по Инмону**

![](/image/ik.png)

**Преимущества хранилища по Кимбаллу** 

![](/image/ki.png)

