# Современные модели DWH: Data Vault и якорная модель 
Американский специалист по данным Дэн Линстедт разработал модель Data Vault в 1990-х годах и представил её публике в 2000 году. В пяти статьях для **Data Administration Newsletter** Линстедт подробно описал основную концепцию этой модели, правила её создания и соединения основных элементов (таблиц), привёл примеры применения модели для решения задач пользователей и методы загрузки данных в хранилище. Этот подход был разработан во время создания хранилища данных для Министерства Обороны США и показал свою эффективность. В 2013 году Линстедт представил обновлённую версию 2.0, которая была адаптирована под новые технологии (NoSQL, Hadoop) и новые требования к DWH.
В 2004 году в Швеции впервые применили якорную модель для создания хранилища данных страховой компании. Ларс Рённбек представил эту модель на международной арене в 2007 году на конференции Transforming Data with Intelligence (TDWI) в Амстердаме. Его презентация привлекла внимание участников конференции и стала стимулом для формального описания модели. С того времени Ларс Рённбек вместе с Олле Регардтом и командой факультета компьютерных и системных наук Стокгольмского университета проводили исследования по якорному моделированию. В 2008 году на 28-й Международной конференции по концептуальному моделированию была опубликована первая статья, формализующая якорное моделирование, которая была удостоена награды за лучшую работу. 

# Архитектура Data Vault 
В подходе Линстедта данные из операционных систем прежде всего поступают в слой сырых данных (staging area). Он позволяет снизить нагрузку на системы-источники при выполнении запросов. Таблицы staging-слоя по структуре совпадают с таблицами источников. Они также обогащены системными колонками со значениями хэшей бизнес-ключей, информацией об источнике данных, временем загрузки и др. 

Следующий этап — разбить таблицы staging-слоя на хабы, ссылки и сателлиты в слое сырой data vault, или raw data vault.

![vault](/image/vault.png)

# Это основные компоненты Data Vault: 
**Хаб (hub)** — таблица, соответствующая бизнес-сущности (напр., Заказ, Адрес, Клиент). Содержит бизнес-ключ из одного или нескольких полей, хэш-ключ от бизнес-ключа и системные поля (время загрузки, идентификатор источника и другие).
![hub](/image/hub.png)

**Ссылка (link)** — таблица, связывающая несколько хабов связью многие-ко-многим. Содержит хэш-ключи связываемых хабов, собственный хэш-ключ, построенный на хэш-ключах связываемых хабов, и те же системные поля, что и хаб.
![link](/image/link.png)

**Сателлит (satellite)** — таблица, содержащая описательные атрибуты хаба или ссылки. Сателлит может хранить историю изменения: проще всего для этого завести поле с хэшем от всех описательных атрибутов. Сателлит содержит хэш-ключ (тот же, что и в хабе), описательные атрибуты, хэш от всех описательных атрибутов и системные поля (те же, что в линках и хабах). Для хаба или ссылки может существовать сколько угодно сателлитов — это позволяет разделять описательные атрибуты по глубине хранения, периодичности сбора и другим параметрам.
![satellite](/image/satellite.png)
При загрузке данных в слой raw data vault данные не обрабатываются дополнительно. Если нужны агрегация или другая обработка данных, то вводится дополнительный слой — business vault. Он строится по тем же принципам, что и raw data vault, но содержит обработанные данные — агрегированные или приведённые к нужной единице измерения.
Ну и для того, чтобы пользователю не пришлось страдать, объединяя десятки таблиц для получения необходимого среза данных, в концепции Data Vault обязательно есть слой витрин (data mart).
